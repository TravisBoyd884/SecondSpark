# -----------------------------------------------------------
# DEVELOPMENT STAGE
# This single stage is optimized for live development.
# -----------------------------------------------------------
FROM node:20-alpine AS development

# Install compatibility library 'libc6-compat' for Node and enable pnpm
RUN apk add --no-cache libc6-compat && corepack enable && corepack prepare pnpm@10.18.1 --activate

# Set environment variable to indicate development mode
ENV NODE_ENV=development

# Working directory inside of docker container
WORKDIR /app

# Copy lockfile and manifest first for efficient caching
COPY pnpm-lock.yaml package.json ./

# Install all dependencies (dev and prod). 
# We remove the --frozen-lockfile flag so developers can add dependencies easily.
RUN pnpm install

# Copy all application source code
# Note: When running, you should use Docker volume mounting (-v) 
# to sync files from your host machine into this container.
COPY . .

# Expose the port Next.js development server runs on (default is 3000)
EXPOSE 3000

# *** IMPORTANT: Start the Next.js development server ***
# This command enables hot-reloading and development features.
# 'next dev' typically binds to 0.0.0.0 by default, allowing external access.
CMD ["pnpm", "run", "dev"]
